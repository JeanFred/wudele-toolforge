server.modules += ("mod_auth", "mod_authn_file")

$HTTP["url"] =~ "^/{{ tool_name }}/admin/" {
  auth.backend = "plain"
  auth.backend.plain.userfile = ".auth.txt"
  auth.require = ("/{{ tool_name }}/admin/" => (
     "method"  => "basic",
     "realm"   => "admin",
     "require" => "valid-user"
  ))
}

url.rewrite-once += (
    "^/{{ tool_name }}/admin$" => "/{{ tool_name }}/admin/",

    "^/{{ tool_name }}/([a-zA-Z0-9-]+)$"                           => "/{{ tool_name }}/studs.php?poll=$1",
    "^/{{ tool_name }}/([a-zA-Z0-9-]+)/action/([a-zA-Z_-]+)/(.+)$" => "/{{ tool_name }}/studs.php?poll=$1&$2=$3",
    "^/{{ tool_name }}/([a-zA-Z0-9-]+)/vote/([a-zA-Z0-9]{16})$"    => "/{{ tool_name }}/studs.php?poll=$1&vote=$2",

    "^/{{ tool_name }}/([a-zA-Z0-9-]{24})/admin$"                              => "/{{ tool_name }}/adminstuds.php?poll=$1",
    "^/{{ tool_name }}/([a-zA-Z0-9-]{24})/admin/vote/([a-zA-Z0-9]{16})$"       => "/{{ tool_name }}/adminstuds.php?poll=$1&vote=$2",
    "^/{{ tool_name }}/([a-zA-Z0-9-]{24})/admin/action/([a-zA-Z_-]+)(/(.+))?$" => "/{{ tool_name }}/adminstuds.php?poll=$1&$2=$4"
)
